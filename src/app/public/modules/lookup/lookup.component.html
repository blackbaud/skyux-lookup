<ng-container *ngIf="!inputBoxHostSvc">
  <ng-container *ngTemplateOutlet="inputTemplateRef"></ng-container>
</ng-container>

<ng-template
  #inputTemplateRef
>
  <div
    class="sky-lookup"
    [ngClass]="{
      'sky-lookup-focused': isInputFocused,
      'sky-lookup-disabled': disabled,
      'sky-lookup-single': selectMode === 'single'
    }"
  >
    <sky-autocomplete
      [ariaLabelledBy]="ariaLabelledBy"
      [data]="data"
      [debounceTime]="debounceTime"
      [descriptorProperty]="descriptorProperty"
      [enableShowMore]="enableShowMore"
      [propertiesToSearch]="propertiesToSearch"
      [search]="search"
      [searchFilters]="searchFilters"
      [searchResultsLimit]="searchResultsLimit"
      [searchResultTemplate]="searchResultTemplate"
      [searchTextMinimumCharacters]="searchTextMinimumCharacters"
      [showAddButton]="showAddButton"
      (addClick)="addButtonClicked()"
      (showMoreClick)="showMoreButtonClicked()"
      (selectionChange)="onAutocompleteSelectionChange($event)">

      <div
        class="sky-lookup-search"
        [ngClass]="{
          'sky-field-status-active': isInputFocused
        }"
      >
        <sky-tokens *ngIf="selectMode === 'multiple'"
          class="sky-lookup-tokens"
          [disabled]="disabled"
          [displayWith]="descriptorProperty"
          [focusable]="false"
          [messageStream]="tokensController"
          [trackWith]="idProperty"
          [tokens]="tokens"
          (keyup)="onTokensKeyUp($event)"
          (tokensChange)="onTokensChange($event)"
          (tokenSelected)="enableShowMore ? showMoreButtonClicked() : undefined"
          (focusIndexOverRange)="onTokensFocusIndexOverRange()"
        >
          <textarea
            class="sky-form-control sky-lookup-input"
            rows="1"
            skyAutocomplete
            wrap="off"
            [attr.aria-label]="ariaLabel"
            [attr.aria-labelledby]="ariaLabelledBy"
            [attr.placeholder]="placeholderText"
            [autocompleteAttribute]="autocompleteAttribute"
            [disabled]="disabled"
            (blur)="onAutocompleteBlur()"
            (keydown)="inputKeydown($event, $event.target.value)"
            (keyup)="inputKeyup($event)"
          ></textarea>
        </sky-tokens>
        <div *ngIf="selectMode === 'single'"
          class="sky-lookup-single-control"
        >
          <textarea
            class="sky-form-control sky-lookup-input"
            rows="1"
            skyAutocomplete
            wrap="off"
            [attr.aria-label]="ariaLabel"
            [attr.aria-labelledby]="ariaLabelledBy"
            [attr.placeholder]="placeholderText"
            [autocompleteAttribute]="autocompleteAttribute"
            [disabled]="disabled"
            (blur)="onAutocompleteBlur()"
          ></textarea>
        </div>
      </div>
    </sky-autocomplete>
  </div>
</ng-template>
